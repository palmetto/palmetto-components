import { useState } from 'react';
import { BrowserRouter, Link } from 'react-router-dom';
import { action } from '@storybook/addon-actions';
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs/blocks';
import Popover from './Popover';
import Card from '../Card/Card';
import Button from '../Button/Button';
import Box from '../Box/Box';
import Heading from '../Heading/Heading';
import TextInput from '../TextInput/TextInput';

<Meta
  title="Components/Popover"
  component={Popover}
/>

# Popover

Use popovers to show content of any kind behind the context of a specific trigger, some examples
of uses for a popover include: 
1. Dropdowns
2. Tooltips
3. Context Menus

## Props

<ArgsTable of={Popover} />

## Default

<Canvas>
  <Story name="Default">
    {() => {
      const [isPopoverOpen, setPopoverOpen] = useState(false);
      const handleOpenPopover = () => { setPopoverOpen(!isPopoverOpen); };
      const cardContent = (<>Hello!</>);
      return (
        <div>
          <Popover
            content={cardContent}
            isOpen={isPopoverOpen}
            placement="right"
            contentContainerProps={{
              padding: 'sm',
            }}
          >
            <Button onClick={handleOpenPopover} variant="light">Click me!</Button>
          </Popover>
        </div>
      );
    }}
  </Story>
</Canvas>

## Placement

<Canvas>
  <Story name="Placement">
    {() => {
      const [isPopoverOpen, setPopoverOpen] = useState({
        'auto': false,
        'auto-start': false,
        'auto-end': false,
        'top': false,
        'bottom': false,
        'right': false,
        'left': false,
        'top-start': false,
        'top-end': false,
        'bottom-start': false,
        'bottom-end': false,
        'right-start': false,
        'right-end': false,
        'left-start': false,
        'left-end': false,
      });
      const handleOpenPopover = (key) => {
        setPopoverOpen({ ...isPopoverOpen, [key]: !isPopoverOpen[key] });
      };
      const positions = [
        'auto',
        'auto-start',
        'auto-end',
        'top',
        'bottom',
        'right',
        'left',
        'top-start',
        'top-end',
        'bottom-start',
        'bottom-end',
        'right-start',
        'right-end',
        'left-start',
        'left-end',
      ];
      return (
        <Box direction="row" childGap="md" wrap>
          {positions.map(position => (
            <Box
              height="100px"
              padding="5xl"
              display="inline-block"
              key={position}
            >
              <Popover
                content={<>{position}</>}
                isOpen={isPopoverOpen[position]}
                placement={position}
                contentContainerProps={{
                  padding: 'sm',
                  background: 'secondary',
                  color: 'white',
                }}
              >
                <Button
                  onClick={() => handleOpenPopover(position)}
                  variant="light"
                >
                  {position}
                </Button>
              </Popover>
            </Box>
          ))}
        </Box>
      );
    }}
  </Story>
</Canvas>

## With a Portal

<Canvas>
  <Story name="With a Portal">
    {() => {
      const [isPopoverOpen, setPopoverOpen] = useState(false);
      const handleOpenPopover = () => { setPopoverOpen(!isPopoverOpen); };
      const popoverContent = (
        <>
          <Heading style={{ marginBottom: '0.5rem' }}>I am living in the body element!</Heading>
          <p>That's why I can break out of my container without getting cut off</p>
        </>
      );
      return (
        <Box display="inline-block">
          <Popover
            content={popoverContent}
            isOpen={isPopoverOpen}
            placement="right-start"
            contentContainerProps={{
              padding: 'md',
              background: 'secondary',
              color: 'white',
            }}
            withPortal
          >
            <Button onClick={handleOpenPopover} variant="light">Click me!</Button>
          </Popover>
        </Box>
      );
    }}
  </Story>
</Canvas>


## Hover Trigger

<Canvas>
  <Story name="Hover">
    {() => {
      const [isPopoverOpen, setPopoverOpen] = useState(false);
      const handleOpenPopover = () => { setPopoverOpen(!isPopoverOpen); };
      const popoverContent = (
        <>
          <Heading style={{ marginBottom: '0.5rem' }}>I just appeared on hover!</Heading>
          <p>My visibility can easily be managed by attaching listeners to the trigger element</p>
        </>
      );
      return (
        <Box display="inline-block">
          <Popover
            content={popoverContent}
            isOpen={isPopoverOpen}
            placement="right-start"
            contentContainerProps={{
              padding: 'md',
              background: 'primary-light'
            }}
            withPortal
          >
            <Button
              onMouseOver={() => setPopoverOpen(true)}
              onMouseOut={() => setPopoverOpen(false)}
              variant="light"
            >
              Click me!
            </Button>
          </Popover>
        </Box>
      );
    }}
  </Story>
</Canvas>


## Respond to Outside Clicks

<Canvas>
  <Story name="Outside Clicks">
    {() => {
      const [isPopoverOpen, setPopoverOpen] = useState(false);
      const handleTogglePopover = () => { setPopoverOpen(!isPopoverOpen); };
      const popoverContent = (
        <>
          <Heading style={{ marginBottom: '0.5rem' }}>I will close if you click outside!</Heading>
          <p>The event listener is attached to the document body.</p>
        </>
      );
      return (
        <Box display="inline-block">
          <Popover
            content={popoverContent}
            isOpen={isPopoverOpen}
            placement="right-start"
            contentContainerProps={{
              padding: 'md',
              background: 'primary-light'
            }}
            withPortal
            onClickOutside={() => setPopoverOpen(false)}
          >
            <Button
              onClick={handleTogglePopover}
              variant="light"
            >
              Click to Open
            </Button>
          </Popover>
        </Box>
      );
    }}
  </Story>
</Canvas>

## Trapping Focus

<Canvas>
  <Story name="Trapping Focus">
    {() => {
      const [isPopoverOpen, setPopoverOpen] = useState(false);
      const [inputValue, setInputValue] = useState('');
      const handleTogglePopover = () => { setPopoverOpen(!isPopoverOpen); };
      const handleInputChange = (event) => { setInputValue(event.target.value); };
      const popoverContent = (
        <>
          <Box direction="column" childGap="sm">
            <Heading>Only the elements on this Popover can be tabbed into</Heading>
            <TextInput onChange={handleInputChange} value={inputValue} />
            <Button>Submit</Button>
          </Box>
        </>
      );
      return (
        <Box display="inline-block">
          <Popover
            content={popoverContent}
            isOpen={isPopoverOpen}
            placement="right-start"
            contentContainerProps={{
              padding: 'md',
              background: 'grey-lighter'
            }}
            withPortal
            onClickOutside={() => setPopoverOpen(false)}
            trapFocus
          >
            <Button
              onClick={handleTogglePopover}
              variant="light"
            >
              Click to Open
            </Button>
          </Popover>
        </Box>
      );
    }}
  </Story>
</Canvas>