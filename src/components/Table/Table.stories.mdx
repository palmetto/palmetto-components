import { useState, useEffect } from 'react';
import { action } from '@storybook/addon-actions';
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs/blocks';
import Button from '../Button/Button';
import Table from './Table';

<Meta
  title="Components/Table"
  component={Table}
/>

# Table

Use tables to render datasets.

Tables display information in a way thatâ€™s easy to scan, while making it easy to interact with individual records in a data set.

Lastly use tables when you need the ability to sort, filter and/or paginate data.

## Props

<ArgsTable of={Table} />

## Default

<Canvas>
  <Story name="Default">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table 
          rowKey="id" 
          columns={columnConfig} 
          rows={tableData} 
        />
      );
    }}
  </Story>
</Canvas>

## Loading

<Canvas>
  <Story name="Loading">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table 
          rowKey="id" 
          columns={columnConfig} 
          rows={tableData} 
          isLoading 
        />
      );
    }}
  </Story>
</Canvas>


## Sortable

<Canvas>
  <Story name="Sortable">
    {() => {
      const sortDescending = (arrOfObj, key) => [...arrOfObj].sort((a, b) => (b[key] > a[key]) ? 1 : -1);
      const sortAscending = (arrOfObj, key) => [...arrOfObj].sort((a, b) => (a[key] > b[key]) ? 1 : -1);
      const getNewSortDirection = (event, currentSortedColumn) => {
        if (
          event.sortedKey === currentSortedColumn.dataKey
          && currentSortedColumn.sortDirection === 'ascending'
        ) return 'descending';
        return 'ascending';
      };
      const initialData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'green', flavor: 'strawberry' },
        { id: 3, color: 'blue', flavor: 'chocolate' },
      ];
      const [sortedColumn, setSortedColumn] = useState({});
      const [tableData, setTableData] = useState(initialData);
      const handleSort = event => {
        const newSortDirection = getNewSortDirection(event, sortedColumn);
        setSortedColumn({
          dataKey: event.sortedKey,
          sortDirection: newSortDirection,
        });
      };
      useEffect(() => {
        if (sortedColumn.dataKey && sortedColumn.sortDirection) {
          const sortedData =
            sortedColumn.sortDirection === 'ascending'
            ? sortAscending(tableData, sortedColumn.dataKey)
            : sortDescending(tableData, sortedColumn.dataKey);
          setTableData(sortedData);
        }
      }, [sortedColumn]);
      const columnConfig = [
        { title: 'ID', dataKey: 'id', isSortable: true },
        { title: 'Color', dataKey: 'color', isSortable: true },
        { title: 'Flavor', dataKey: 'flavor', isSortable: true },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          sortedColumn={sortedColumn}
          onSort={handleSort}
        />
      );
    }}
  </Story>
</Canvas>


## Sortable with Default Sorted Column

<Canvas>
  <Story name="Sortable with Default Sorted Column">
    {() => {
      const sortDescending = (arrOfObj, key) => [...arrOfObj].sort((a, b) => (b[key] > a[key]) ? 1 : -1);
      const sortAscending = (arrOfObj, key) => [...arrOfObj].sort((a, b) => (a[key] > b[key]) ? 1 : -1);
      const getNewSortDirection = (event, currentSortedColumn) => {
        if (
          event.sortedKey === currentSortedColumn.dataKey
          && currentSortedColumn.sortDirection === 'ascending'
        ) return 'descending';
        return 'ascending';
      };
      const initialData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'green', flavor: 'strawberry' },
        { id: 3, color: 'blue', flavor: 'chocolate' },
      ];
      const [sortedColumn, setSortedColumn] = useState({ dataKey: 'color', sortDirection: 'descending' });
      const [tableData, setTableData] = useState([
        ...sortedColumn.sortDirecton === 'ascending'
        ? sortAscending(initialData, sortedColumn.dataKey)
        : sortDescending(initialData, sortedColumn.dataKey)
      ]);
      const handleSort = event => {
        const newSortDirection = getNewSortDirection(event, sortedColumn);
        setSortedColumn({
          dataKey: event.sortedKey,
          sortDirection: newSortDirection,
        });
      };
      useEffect(() => {
        if (sortedColumn.dataKey && sortedColumn.sortDirection) {
          const sortedData =
            sortedColumn.sortDirection === 'ascending'
            ? sortAscending(tableData, sortedColumn.dataKey)
            : sortDescending(tableData, sortedColumn.dataKey);
          setTableData(sortedData);
        }
      }, [sortedColumn]);
      const columnConfig = [
        { title: 'ID', dataKey: 'id', isSortable: true },
        { title: 'Color', dataKey: 'color', isSortable: true },
        { title: 'Flavor', dataKey: 'flavor', isSortable: true },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          sortedColumn={sortedColumn}
          onSort={handleSort}
        />
      );
    }}
  </Story>
</Canvas>


## Sortable and Loading

Setting the `isLoading` prop to true will disable clicking on the column headers. This prevents a race condition where an attempt to sort is made before data from the previous load is available.

<Canvas>
  <Story name="Sortable and Loading">
    {() => {
      const sortDescending = (arrOfObj, key) => [...arrOfObj].sort((a, b) => (b[key] > a[key]) ? 1 : -1);
      const sortAscending = (arrOfObj, key) => [...arrOfObj].sort((a, b) => (a[key] > b[key]) ? 1 : -1);
      const getNewSortDirection = (event, currentSortedColumn) => {
        if (
          event.sortedKey === currentSortedColumn.dataKey
          && currentSortedColumn.sortDirection === 'ascending'
        ) return 'descending';
        return 'ascending';
      };
      const initialData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'green', flavor: 'strawberry' },
        { id: 3, color: 'blue', flavor: 'chocolate' },
      ];
      const [sortedColumn, setSortedColumn] = useState({});
      const [tableData, setTableData] = useState(initialData);
      const handleSort = event => {
        const newSortDirection = getNewSortDirection(event, sortedColumn);
        setSortedColumn({
          dataKey: event.sortedKey,
          sortDirection: newSortDirection,
        });
      };
      useEffect(() => {
        if (sortedColumn.dataKey && sortedColumn.sortDirection) {
          const sortedData =
            sortedColumn.sortDirection === 'ascending'
            ? sortAscending(tableData, sortedColumn.dataKey)
            : sortDescending(tableData, sortedColumn.dataKey);
          setTableData(sortedData);
        }
      }, [sortedColumn])
      const columnConfig = [
        { title: 'ID', dataKey: 'id', isSortable: true },
        { title: 'Color', dataKey: 'color', isSortable: true },
        { title: 'Flavor', dataKey: 'flavor', isSortable: true },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          sortedColumn={sortedColumn}
          onSort={handleSort}
          isLoading
        />
      );
    }}
  </Story>
</Canvas>

## Scroll Horizontally (x axis)

<Canvas>
  <Story name="Scroll (x)">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
        { title: 'Brightness', dataKey: 'brightness' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla', brightness: 'light' },
        { id: 2, color: 'blue', flavor: 'chocolate', brightness: 'medium' },
        { id: 3, color: 'green', flavor: 'strawberry', brightness: 'dark' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          scroll={{ x: 200 }}
        />
      );
    }}
  </Story>
</Canvas>

## Scroll Vertically (y axis)

<Canvas>
  <Story name="Scroll (y)">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
        { title: 'Brightness', dataKey: 'brightness' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla', brightness: 'light' },
        { id: 2, color: 'blue', flavor: 'chocolate', brightness: 'medium' },
        { id: 3, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 4, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 5, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 6, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 7, color: 'green', flavor: 'strawberry', brightness: 'dark' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          scroll={{ y: 150 }}
        />
      );
    }}
  </Story>
</Canvas>

## Scroll Horizontally and Vertically (x and y axes)

<Canvas>
  <Story name="Scroll (x and y)">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
        { title: 'Brightness', dataKey: 'brightness' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla', brightness: 'light' },
        { id: 2, color: 'blue', flavor: 'chocolate', brightness: 'medium' },
        { id: 3, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 4, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 5, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 6, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 7, color: 'green', flavor: 'strawberry', brightness: 'dark' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          scroll={{ x: 200, y: 150 }}
        />
      );
    }}
  </Story>
</Canvas>


## Fixed-Width Columns

<Canvas>
  <Story name="Fixed-Width Columns">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id', width: 200 },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          useFixedWidthColumns
        />
      );
    }}
  </Story>
</Canvas>


## Truncate Overflow

<Canvas>
  <Story name="Truncate Overflow">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color', width: 100 },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue longy long long long', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          useFixedWidthColumns
          truncateOverflow
        />
      );
    }}
  </Story>
</Canvas>


## Custom Actions

<Canvas>
  <Story name="Custom Actions">
    {() => {
      const renderFlavor = (cell, row, index) => {
        const rows = [
          { href: cell.href, name: cell.name, id: row.id, index, }
        ];
        const columns = [
          { title: 'Url', dataKey: 'href', render: (cell) => <a href={cell}>{cell}</a> },
          { title: 'Name', dataKey: 'name' },
          { title: 'ID', dataKey: 'id' },
          { title: 'Index', dataKey: 'index' },
        ];
        return (
          <Table 
            columns={columns} 
            rows={rows} 
            rowKey="id" 
            isCompact 
          />
        );
      };
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Render based on the record', dataKey: 'flavor', render: renderFlavor},
        { title: 'Render anything you want', render: () => <Button>Do anything</Button> }
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: { name: 'vanilla', href: 'www.vanilla.com' } },
        { id: 2, color: 'blue', flavor: { name: 'chocolate', href: 'www.chocolate.com' } },
        { id: 3, color: 'green', flavor: { name: 'strawberry', href: 'www.strawberry.com' } },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
        />
      );
    }}
  </Story>
</Canvas>

## Striped

<Canvas>
  <Story name="Striped">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
        { id: 4, color: 'green', flavor: 'strawberry' },
        { id: 5, color: 'green', flavor: 'strawberry' },
        { id: 6, color: 'green', flavor: 'strawberry' },
        { id: 7, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table 
          rowKey="id" 
          columns={columnConfig} 
          rows={tableData} 
          isStriped 
        />
      );
    }}
  </Story>
</Canvas>


## Empty Cell Placeholder
The empty cell placeholder can be set on a global level as a prop on `<Table />` or individually per column
by adding the `emptyCellPlaceholder` to the column configuration object. In cases where both is set, the column
placeholder takes precedence over the global placeholder. As seen in the example below where the price column uses
`$0.00` as a placeholder where a price is missing.  

<Canvas>
  <Story name="Empty Cell Placeholder">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color', emptyCellPlaceholder: '--' },
        { title: 'Flavor', dataKey: 'flavor' },
        { title: 'Price', dataKey: 'price', render: (cell) => cell ?`$${cell}` : null, emptyCellPlaceholder: '$0.00'}
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla', price: 10 },
        { id: 2, color: '', flavor: 'chocolate', price: 12.21 },
        { id: 3, color: 'green', flavor: 'strawberry', price: 9.24 },
        { id: 4, color: 'blue', flavor: 'rocky road' },
      ];
      return (
        <Table 
          rowKey="id" 
          columns={columnConfig} 
          rows={tableData} 
        />
      );
    }}
  </Story>
</Canvas>


## Borderless

<Canvas>
  <Story name="Borderless">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table 
          rowKey="id" 
          columns={columnConfig} 
          rows={tableData} 
          isBorderless 
        />
      );
    }}
  </Story>
</Canvas>


## Compact

<Canvas>
  <Story name="Compact Cells">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table 
          rowKey="id" 
          columns={columnConfig} 
          rows={tableData} 
          isCompact 
        />
      );
    }}
  </Story>
</Canvas>


## Hover

<Canvas>
  <Story name="Hoverable Rows">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table 
          rowKey="id" 
          columns={columnConfig} 
          rows={tableData} 
          hoverableRows 
        />
      );
    }}
  </Story>
</Canvas>

## Striped & Hoverable

<Canvas>
  <Story name="Striped and Hoverable Rows">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table 
          rowKey="id" 
          columns={columnConfig} 
          rows={tableData} 
          hoverableRows 
          isStriped 
        />
      );
    }}
  </Story>
</Canvas>
