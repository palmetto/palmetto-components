import { useState } from 'react';
import { action } from '@storybook/addon-actions';
import { withA11y } from '@storybook/addon-a11y';
import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import Button from '../Button/Button';
import Table from './Table';

<Meta
  title="Components/Table"
  component={Table}
  decorators={[withA11y]}
/>

# Table

Use tables to render datasets.

Tables display information in a way thatâ€™s easy to scan, while making it easy to interact with individual records in a data set.

Lastly use tables when you need the ability to sort, filter and/or paginate data.

## Props

<Props of={Table} />

## Default

<Preview>
  <Story name="Default">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table rowKey="id" columns={columnConfig} rows={tableData} />
      );
    }}
  </Story>
</Preview>

## Loading

<Preview>
  <Story name="Loading">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table rowKey="id" columns={columnConfig} rows={tableData} isLoading />
      );
    }}
  </Story>
</Preview>


## Sortable

<Preview>
  <Story name="Sortable">
    {() => {
      const getNewSortDirection = (event, currentSortedColumn) => {
        if (
          event.sortedKey === currentSortedColumn.dataKey
          && currentSortedColumn.sortDirection === 'ascending'
        ) return 'descending';
        return 'ascending';
      };
      const initialData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 3, color: 'green', flavor: 'strawberry' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
      ];
      const [sortedColumn, setSortedColumn] = useState({});
      const [tableData, setTableData] = useState([...initialData]);
      const handleSort = event => {
        setSortedColumn({
          dataKey: event.sortedKey,
          sortDirection: getNewSortDirection(event, sortedColumn),
        });
        const sortedData = tableData.sort((a, b) => (a[event.sortedKey] > b[event.sortedKey]) ? 1 : -1)
        setTableData(sortedData);
      };
      const columnConfig = [
        { title: 'ID', dataKey: 'id', isSortable: true },
        { title: 'Color', dataKey: 'color', isSortable: true },
        { title: 'Flavor', dataKey: 'flavor', isSortable: true },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          sortedColumn={sortedColumn}
          onSort={handleSort}
        />
      );
    }}
  </Story>
</Preview>


## Sortable with Default Sorted Column

<Preview>
  <Story name="Sortable with Default">
    {() => {
      const getNewSortDirection = (event, currentSortedColumn) => {
        if (
          event.sortedKey === currentSortedColumn.dataKey
          && currentSortedColumn.sortDirection === 'ascending'
        ) return 'descending';
        return 'ascending';
      };
      const initialData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      const [sortedColumn, setSortedColumn] = useState({ dataKey: 'id', sortDirection: 'ascending' });
      const [tableData, setTableData] = useState([...initialData]);
      const handleSort = event => {
        setSortedColumn({
          dataKey: event.sortedKey,
          sortDirection: getNewSortDirection(event, sortedColumn),
        });
        const sortedData = tableData.sort((a, b) => (a[event.sortedKey] > b[event.sortedKey]) ? 1 : -1)
        setTableData(sortedData);
      };
      const columnConfig = [
        { title: 'ID', dataKey: 'id', isSortable: true },
        { title: 'Color', dataKey: 'color', isSortable: true },
        { title: 'Flavor', dataKey: 'flavor', isSortable: true },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          sortedColumn={sortedColumn}
          onSort={handleSort}
        />
      );
    }}
  </Story>
</Preview>


## Sortable and Loading

Setting the `isLoading` prop to true will disable clicking on the column headers. This prevents a race condition where an attempt to sort is made before data from the previous load is available.

<Preview>
  <Story name="Sortable and Loading">
    {() => {
      const getNewSortDirection = (event, currentSortedColumn) => {
        if (
          event.sortedKey === currentSortedColumn.dataKey
          && currentSortedColumn.sortDirection === 'ascending'
        ) return 'descending';
        return 'ascending';
      };
      const initialData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      const [sortedColumn, setSortedColumn] = useState({ dataKey: 'id', sortDirection: 'ascending' });
      const [tableData, setTableData] = useState([...initialData]);
      const handleSort = event => {
        setSortedColumn({
          dataKey: event.sortedKey,
          sortDirection: getNewSortDirection(event, sortedColumn),
        });
        const sortedData = tableData.sort((a, b) => (a[event.sortedKey] > b[event.sortedKey]) ? 1 : -1)
        setTableData(sortedData);
      };
      const columnConfig = [
        { title: 'ID', dataKey: 'id', isSortable: true },
        { title: 'Color', dataKey: 'color', isSortable: true },
        { title: 'Flavor', dataKey: 'flavor', isSortable: true },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          sortedColumn={sortedColumn}
          onSort={handleSort}
          isLoading
        />
      );
    }}
  </Story>
</Preview>

## Scroll Horizontally (x axis)

<Preview>
  <Story name="Scroll (x)">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
        { title: 'Brightness', dataKey: 'brightness' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla', brightness: 'light' },
        { id: 2, color: 'blue', flavor: 'chocolate', brightness: 'medium' },
        { id: 3, color: 'green', flavor: 'strawberry', brightness: 'dark' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          scroll={{ x: 200 }}
        />
      );
    }}
  </Story>
</Preview>

## Scroll Vertically (y axis)

<Preview>
  <Story name="Scroll (y)">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
        { title: 'Brightness', dataKey: 'brightness' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla', brightness: 'light' },
        { id: 2, color: 'blue', flavor: 'chocolate', brightness: 'medium' },
        { id: 3, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 4, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 5, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 6, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 7, color: 'green', flavor: 'strawberry', brightness: 'dark' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          scroll={{ y: 150 }}
        />
      );
    }}
  </Story>
</Preview>

## Scroll Horizontally and Vertically (x and y axes)

<Preview>
  <Story name="Scroll (x and y)">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
        { title: 'Brightness', dataKey: 'brightness' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla', brightness: 'light' },
        { id: 2, color: 'blue', flavor: 'chocolate', brightness: 'medium' },
        { id: 3, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 4, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 5, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 6, color: 'green', flavor: 'strawberry', brightness: 'dark' },
        { id: 7, color: 'green', flavor: 'strawberry', brightness: 'dark' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          scroll={{ x: 200, y: 150 }}
        />
      );
    }}
  </Story>
</Preview>


## Fixed-Width Columns

<Preview>
  <Story name="Fixed-width Columns">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id', width: 200 },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          useFixedWidthColumns
        />
      );
    }}
  </Story>
</Preview>


## Truncate Overflow

<Preview>
  <Story name="Truncate Overflow">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color', width: 100 },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue longy long long long', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
          useFixedWidthColumns
          truncateOverflow
        />
      );
    }}
  </Story>
</Preview>


## Custom Actions

<Preview>
  <Story name="Custom Actions">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'With some JSX flavor', dataKey: 'flavor', render: (cell) => <a href={cell.href}>{cell.name}</a>},
        { title: 'Custom JSX', render: () => <Button>My Button</Button> }
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: { name: 'vanilla', href: 'www.vanilla.palmetto.com' } },
        { id: 2, color: 'blue', flavor: { name: 'chocolate', href: 'www.chocolate.palmetto.com' } },
        { id: 3, color: 'green', flavor: { name: 'strawberry', href: 'www.strawberry.palmetto.com' } },
      ];
      return (
        <Table
          rowKey="id"
          columns={columnConfig}
          rows={tableData}
        />
      );
    }}
  </Story>
</Preview>

## Striped

<Preview>
  <Story name="Striped">
    {() => {
      const columnConfig = [
        { title: 'ID', dataKey: 'id' },
        { title: 'Color', dataKey: 'color' },
        { title: 'Flavor', dataKey: 'flavor' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
        { id: 4, color: 'green', flavor: 'strawberry' },
        { id: 5, color: 'green', flavor: 'strawberry' },
        { id: 6, color: 'green', flavor: 'strawberry' },
        { id: 7, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table rowKey="id" columns={columnConfig} rows={tableData} isStriped />
      );
    }}
  </Story>
</Preview>

<!--
## Empty Cell Placeholder

<Preview>
  <Story name="Empty Cell Placeholder">
    {() => {
      const columnConfig = [
        { heading: 'ID', id: 'first' },
        { heading: 'Color', id: 'second' },
        { heading: 'Flavor', id: 'third' },
      ];
      const tableData = [
        { id: undefined, color: 'red', flavor: 'vanilla' },
        { id: 2, color: null, flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: '' },
      ];
      return (
        <Table>
          <TableHead columns={columnConfig} />
          <TableBody>
            {tableData.map(row => <TableRow data={row} key={row.id} id={row.id} emptyCellPlaceholder="--" />)}
          </TableBody>
        </Table>
      );
    }}
  </Story>
</Preview>

## Borderless

<Preview>
  <Story name="Borderless">
    {() => {
      const columnConfig = [
        { heading: 'ID', id: 'first' },
        { heading: 'Color', id: 'second' },
        { heading: 'Flavor', id: 'third' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table isBorderless>
          <TableHead columns={columnConfig} />
          <TableBody>
            {tableData.map(row => <TableRow data={row} key={row.id} id={row.id} />)}
          </TableBody>
        </Table>
      );
    }}
  </Story>
</Preview>

## Compact

<Preview>
  <Story name="Compact">
    {() => {
      const columnConfig = [
        { heading: 'ID', id: 'first' },
        { heading: 'Color', id: 'second' },
        { heading: 'Flavor', id: 'third' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table isCompact>
          <TableHead columns={columnConfig} />
          <TableBody>
            {tableData.map(row => <TableRow data={row} key={row.id} id={row.id} />)}
          </TableBody>
        </Table>
      );
    }}
  </Story>
</Preview>

## Hover

<Preview>
  <Story name="Hover">
    {() => {
      const columnConfig = [
        { heading: 'ID', id: 'first' },
        { heading: 'Color', id: 'second' },
        { heading: 'Flavor', id: 'third' },
      ];
      const tableData = [
        { id: 1, color: 'red', flavor: 'vanilla' },
        { id: 2, color: 'blue', flavor: 'chocolate' },
        { id: 3, color: 'green', flavor: 'strawberry' },
      ];
      return (
        <Table isStriped hoverableRows>
          <TableHead columns={columnConfig} />
          <TableBody>
            {tableData.map(row => <TableRow data={row} key={row.id} id={row.id} />)}
          </TableBody>
        </Table>
      );
    }}
  </Story>
</Preview> -->
